<odoo>
    <!-- Kanban view -->
    <record id="view_workshop_customer_kanban" model="ir.ui.view">
        <field name="name">workshop.customer.kanban</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.res_partner_kanban_view" />
        <field eval="1" name="priority" />
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="inside">
                <field name="is_workshop_customer" />
                <field name="vehicle_count" />
                <field name="maintenance_count" />
            </xpath>
            <xpath expr="//kanban//templates/t[@t-name='card']" position="inside">
                <t t-name="card">
                    <div class="d-flex">
                        <div class="me-2">
                            <field name="avatar_128" widget="image"
                                options="{'size': [100, 100]}" />
                        </div>
                        <div class="p-2">
                            <div>
                                <strong>
                                    <field name="name" />
                                </strong>
                            </div>
                            <div>
                                <field name="email" />
                            </div>
                            <div>
                                <field name="phone" />
                            </div>
                            <div t-if="record.is_workshop_customer.raw_value"
                                class="text-success small">
                                <i class="fa fa-wrench" /> Workshop </div>
                        </div>
                    </div>
                </t>
            </xpath>
        </field>
    </record>

    <!-- List view -->
    <record id="view_workshop_customer_list" model="ir.ui.view">
        <field name="name">workshop.customer.list</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree" />
        <field name="arch" type="xml">
            <xpath expr="//list" position="attributes">
                <attribute name="default_order">name asc</attribute>
            </xpath>
            <xpath expr="//field[@name='complete_name']" position="after">
                <field name="vehicle_count" widget="number" />
                <field name="maintenance_count" widget="number" />
            </xpath>
        </field>
    </record>

    <!-- Form view -->
    <record id="view_workshop_customer_form" model="ir.ui.view">
        <field name="name">workshop.customer.form</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form" />
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="before">
                <field name="is_workshop_customer" invisible="1" />
            </xpath>
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_vehicle"
                    type="object"
                    invisible="vehicle_count == 0 or not is_workshop_customer"
                    icon="fa-car"
                    class="oe_stat_button">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value">
                            <field name="vehicle_count" readonly="1" />
                        </span>
                        <span class="o_stat_text">Vehículos</span>
                    </div>
                </button>
                <button name="action_maintenance"
                    type="object"
                    invisible="maintenance_count == 0 or not is_workshop_customer"
                    icon="fa-wrench"
                    class="oe_stat_button">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value">
                            <field name="maintenance_count" readonly="1" />
                        </span>
                        <span class="o_stat_text">Mantenimientos</span>
                    </div>
                </button>
            </xpath>
            <xpath expr="//notebook" position="inside"
                invisible="('customer_id.is_workshop_customer', '=', False)">
                <page string="Vehicles" name="workshop_vehicles" autofocus="autofocus">
                    <field name="vehicle_ids" context="{'default_customer_id': id}" mode="kanban">
                        <kanban>
                            <field name="name" />
                            <field name="plate" />
                            <field name="vehicle_category" />
                            <field name="last_maintenance" />
                            <field name="avatar_128" />
                            <templates>
                                <t t-name="card" class="flex-row">
                                    <div class="me-2">
                                        <field name="avatar_128" widget="image"
                                            options="{'size': [100, 100]}" />
                                    </div>
                                    <div class="p-2">
                                        <strong>
                                            <field name="name" />
                                        </strong>
                                        <div class="text-muted">
                                            <field name="plate" />
                                        </div>
                                        <div class="text-muted">
                                            <field name="vehicle_category" />
                                        </div>
                                        <div t-if="record.last_maintenance.value"
                                            class="text-muted small"> Último: <field
                                                name="last_maintenance" />
                                        </div>
                                    </div>
                                </t>
                            </templates>
                        </kanban>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Action views -->
    <record id="action_customer" model="ir.actions.act_window">
        <field name="name">Workshop Customers</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('is_workshop_customer', '=', True)]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                There are no registered workshop customers.
            </p>
            <p>
                The workshop's clients are contacts who have vehicles registered for maintenance and
                repair.
            </p>
        </field>
    </record>
</odoo>